System.register(["jimu-core","jimu-ui","jimu-layouts/layout-runtime","jimu-layouts/layout-builder","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-theme"],(function(e,t){var o={},r={},l={},a={},i={},n={},s={};return{setters:[function(e){o.Immutable=e.Immutable,o.LayoutItemType=e.LayoutItemType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.ResizeObserver=e.ResizeObserver,o.WidgetState=e.WidgetState,o.WidgetType=e.WidgetType,o.appActions=e.appActions,o.classNames=e.classNames,o.css=e.css,o.getAppStore=e.getAppStore,o.jsx=e.jsx,o.lodash=e.lodash,o.polished=e.polished},function(e){r.Button=e.Button,r.Icon=e.Icon,r.Loading=e.Loading,r.NavButtonGroup=e.NavButtonGroup,r.Popper=e.Popper,r.Tooltip=e.Tooltip,r.hooks=e.hooks,r.utils=e.utils},function(e){l.LayoutContext=e.LayoutContext,l.searchUtils=e.searchUtils,l.utils=e.utils},function(e){a.CanvasPane=e.CanvasPane,a.DropArea=e.DropArea,a.LayoutBuilder=e.LayoutBuilder,a.addItemToLayout=e.addItemToLayout,a.withRnd=e.withRnd},function(e){i.getAppConfigAction=e.getAppConfigAction},function(e){n.WidgetListPopper=e.WidgetListPopper},function(e){s.getBuilderThemeVariables=e.getBuilderThemeVariables}],execute:function(){e((()=>{var e={55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.745 8l6.1 6.1a.527.527 0 11-.745.746L8 8.746l-6.1 6.1a.527.527 0 11-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 01.746-.746l6.1 6.1 6.1-6.1a.527.527 0 01.746.746L8.746 8z" fill="#000"></path></svg>'},34750:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 0a.5.5 0 00-.5.5V7H.5a.5.5 0 000 1H7v6.5a.5.5 0 001 0V8h6.5a.5.5 0 000-1H8V.5a.5.5 0 00-.5-.5z" fill="#000"></path></svg>'},48891:e=>{"use strict";e.exports=o},23137:e=>{"use strict";e.exports=i},77282:e=>{"use strict";e.exports=a},74758:e=>{"use strict";e.exports=l},34796:e=>{"use strict";e.exports=s},30726:e=>{"use strict";e.exports=r},77756:e=>{"use strict";e.exports=n}},t={};function c(o){var r=t[o];if(void 0!==r)return r.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,c),l.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var o in t)c.o(t,o)&&!c.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var d={};return(()=>{"use strict";c.r(d),c.d(d,{default:()=>Q});var e=c(48891),t=c(30726);const o=e.React.forwardRef(((o,r)=>{var l,a;const{scrollRef:i,className:n,lists:s=[],createItem:c,vertical:d,itemLength:u,space:p,onChange:g,autoHideArrow:v,placeholder:h,minLength:f=u,autoScrollEnd:m}=o,y=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(r=Object.getOwnPropertySymbols(e);l<r.length;l++)t.indexOf(r[l])<0&&Object.prototype.propertyIsEnumerable.call(e,r[l])&&(o[r[l]]=e[r[l]])}return o}(o,["scrollRef","className","lists","createItem","vertical","itemLength","space","onChange","autoHideArrow","placeholder","minLength","autoScrollEnd"]),b=t.hooks.useTranslate(),w=d?"clientHeight":"clientWidth",R=null!==(l=null==s?void 0:s.length)&&void 0!==l?l:0,x=null!==(a=null==h?void 0:h.length)&&void 0!==a?a:u,S=null==h?void 0:h.node,I=null==h?void 0:h.position,C=((t,o,r)=>e.css`
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    .root {
      flex-direction: ${t?"column":"row"};
      width: 100%;
      height: 100%;
      min-width: ${e.polished.rem(r)};
      display: flex;
      justify-content: center;
      flex-wrap: nowrap;
      align-items: center;
      .scroll-list-item {
        &:not(:first-of-type) {
          margin-top: ${t?e.polished.rem(o):"unset"};
          margin-left: ${t?"unset":e.polished.rem(o)};
        }
      }
    }
`)(d,p,f),j=e.React.useRef(null),O=t.hooks.useForkRef(j,r),[A,k]=e.React.useState(0),[L,N]=e.React.useState(0),[E,T]=e.React.useState(0),[P,z]=e.React.useState(0),[W,M]=e.React.useState(!0),[B,D]=e.React.useState(!1),[$,H]=e.React.useState(!0),_=t.hooks.useRefValue(P),G=t.hooks.useRefValue(E),V=t.hooks.useRefValue(L);e.React.useImperativeHandle(i,(()=>({hideArrow:$,disablePrevious:W,disableNext:B,scroll:Y})));const F=e.React.useRef((()=>{}));e.React.useEffect((()=>(F.current=e.lodash.debounce(k,500),()=>{var e;null===(e=F.current)||void 0===e||e.cancel()})),[]);const U=t.hooks.useEventCallback((()=>{var e;let t=j.current[w]||0;t+=p,t-=S?x:0,t=Math.max(t,f),null===(e=F.current)||void 0===e||e.call(F,t)}));e.React.useEffect((()=>{const t=j.current,o=new e.ResizeObserver(U);return o.observe(t),()=>{o.disconnect()}}),[j,U]),e.React.useEffect((()=>{const e=Math.floor(A/u);N(e)}),[A,u]),e.React.useEffect((()=>{let e=G.current,t=_.current;t-e>L?t=G.current+L:t-e<L&&(e=0,t=e+L),T(e),z(t)}),[L,G,_]);const q=e.React.useRef([]),X=t.hooks.useEventCallback((()=>{if(m&&s.length>0&&q.current.length>0&&s[s.length-1]!==q.current[q.current.length-1]){let e=0,t=0;t=R,e=t-V.current,e=Math.max(0,e),T(e),z(t)}}));e.React.useEffect((()=>{X(),q.current=s}),[s,X]);const Y=t.hooks.useEventCallback(((e,t=!0)=>{const o=t?1:L;let r=0,l=0;e?(r=E-o,r<0?(r=0,l=r+L):l=P-o):(l=P+o,l>R?(l=R,r=l-L):r=E+o),T(r),z(l)}));return e.React.useEffect((()=>{const e=P-E>=R,t=P===R;M(0===E),D(t),H(e)}),[E,P,R]),(0,e.jsx)(t.NavButtonGroup,Object.assign({},y,{css:C,type:"tertiary",vertical:d,onChange:e=>{null==g||g(e),Y(e,!0)},disablePrevious:W,disableNext:B,previousAriaLabel:b("previous"),nextAriaLabel:b("next"),previousStyle:{visibility:$?"hidden":"visible"},nextStyle:{visibility:$?"hidden":"visible"},className:(0,e.classNames)("scroll-list",n)}),(0,e.jsx)("div",{className:"root scroll-list-root",ref:O},"start"===I&&S,s.slice(E,P).map((e=>c(e,"scroll-list-item"))),"end"===I&&S))})),r="controller",l={sm:24,default:32,lg:48};var a=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(r=Object.getOwnPropertySymbols(e);l<r.length;l++)t.indexOf(r[l])<0&&Object.prototype.propertyIsEnumerable.call(e,r[l])&&(o[r[l]]=e[r[l]])}return o};const i=(e,t,o)=>{let r=l[e];return t&&(r+=21),r+=2*n(e,o),r},n=(e,t)=>"circle"===t?"sm"===e?4:"default"===e?2:"lg"===e?0:void 0:6,s=e.React.forwardRef(((o,r)=>{var l;const{label:s,className:c,title:d,showLabel:u,showTooltip:p=!0,labelGrowth:g=0,icon:v,marker:h,onMarkerClick:f,avatar:m,autoFlip:y,active:b,editDraggable:w}=o,R=a(o,["label","className","title","showLabel","showTooltip","labelGrowth","icon","marker","onMarkerClick","avatar","autoFlip","active","editDraggable"]),x=m||{},{shape:S,style:I}=x,C=a(x,["shape","style"]),j=null==C?void 0:C.size,[O,A]=e.React.useState(null),k=((t,o,r,l)=>e.React.useMemo((()=>{const a=i(t,o,r),s=a+l,c=n(t,r);return e.css`
      display: flex;
      align-items:center;
      flex-direction: column;
      justify-content: ${o?"space-around":"center"};
      width: ${e.polished.rem(s)} !important;
      height: ${e.polished.rem(a)};
      .tool-drag-handler {
        cursor: auto;
      }
      .avatar {
        padding: ${c}px;
        position: relative;
        text-align: center;
        .marker {
          position: absolute;
          right: 0;
          top: 0;
          padding: 0;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          .icon-btn-sizer {
            min-width: .625rem;
            min-height: .625rem;
          }
        }
      }
      .avatar-label {
        text-align: center;
        width: 100%;
        min-height: ${e.polished.rem(21)};
      }
    `}),[t,o,r,l]))(j,u,S,g),L=(0,e.jsx)(t.Button,Object.assign({icon:!0,active:b,className:"avatar-button",ref:r},C,{style:Object.assign({borderRadius:"circle"===S?"50%":void 0},I)}),(0,e.jsx)(t.Icon,{color:"string"!=typeof v&&(null===(l=v.properties)||void 0===l?void 0:l.color),icon:"string"!=typeof v?v.svg:v,autoFlip:y}));return(0,e.jsx)("div",Object.assign({},R,{className:(0,e.classNames)("avatar-card",`${c} rw-controller__avatar-card`),css:k}),(0,e.jsx)("div",{className:(0,e.classNames)({"no-drag-action":!w},"avatar tool-drag-handler"),onMouseEnter:()=>{A(!0)},onMouseLeave:()=>{A(!1)}},h&&O&&(0,e.jsx)(t.Button,{className:"marker",size:"sm",icon:!0,onClick:f},(0,e.jsx)(t.Icon,{size:8,icon:h})),p?(0,e.jsx)(t.Tooltip,{title:d||s,style:{pointerEvents:"none"}},L):L),u&&(0,e.jsx)("div",{className:(0,e.classNames)("avatar-label text-truncate",{active:b})},s))}));var u=c(74758),p=c(77282),g=c(23137);const v=(t,o)=>{const r=e.ReactRedux.useSelector((e=>e.widgetsRuntimeInfo)),l=h(t,o),a=m(l);return e.React.useMemo((()=>{const t={};return a.forEach((o=>{var l;const a=null!==(l=null==r?void 0:r[o])&&void 0!==l?l:{isClassLoaded:!1,state:e.WidgetState.Closed};t[o]=(0,e.Immutable)(a)})),(0,e.Immutable)(t)}),[a,r])},h=(t,o)=>e.ReactRedux.useSelector((e=>{var r,l,a,i;const n=null===(a=null===(l=null===(r=e.appConfig.widgets)||void 0===r?void 0:r[t])||void 0===l?void 0:l.layouts)||void 0===a?void 0:a[o],s=e.browserSizeMode,c=e.appConfig.mainSizeMode,d=u.searchUtils.findLayoutId(n,s,c);return null===(i=e.appConfig.layouts)||void 0===i?void 0:i[d]})),f=e=>{var t,o,r;let l=(null!==(r=null===(o=null===(t=null==e?void 0:e.order)||void 0===t?void 0:t.asMutable)||void 0===o?void 0:o.call(t))&&void 0!==r?r:[]).map((t=>{var o;return null===(o=e.content)||void 0===o?void 0:o[t]}));return l=l.filter((e=>e&&e.id&&e.widgetId&&!e.isPending)),l.map((e=>e.id))},m=e=>f(e).map((t=>{var o,r;return null===(r=null===(o=e.content)||void 0===o?void 0:o[t])||void 0===r?void 0:r.widgetId})),y=t=>{var o,r;const l=null==t?void 0:t.itemType,a=null===(o=null==t?void 0:t.manifest)||void 0===o?void 0:o.widgetType,i=null===(r=null==t?void 0:t.manifest)||void 0===r?void 0:r.name;return l!==e.LayoutItemType.Section&&a!==e.WidgetType.Layout&&"controller"!==i&&!u.utils.isWidgetPlaceholder(u.utils.getAppConfig(),t)},b=(t,o,r)=>{var l,a,i;const n=null===(i=null===(a=null===(l=(0,e.getAppStore)().getState().appConfig.widgets)||void 0===l?void 0:l[o])||void 0===a?void 0:a.layouts)||void 0===i?void 0:i[r],s=(t=>{var o;const r=(0,e.getAppStore)().getState(),l=u.searchUtils.findLayoutId(t,r.browserSizeMode,r.appConfig.mainSizeMode);return null===(o=r.appConfig.layouts)||void 0===o?void 0:o[l]})(n),c=(0,e.getAppStore)().getState().browserSizeMode;Object.keys(n).forEach((e=>{c!==e&&t.copyLayoutContent(s.id,n[e])}))},w=(e,t)=>{const o=o=>b(o,e,t);return(e,t,r,l,a)=>((e,t,o,r,l,a)=>{const i={layoutId:e.id};let n=(0,g.getAppConfigAction)();(0,p.addItemToLayout)(n.appConfig,t,i,o,r,l||0).then((e=>{n=(0,g.getAppConfigAction)(e.updatedAppConfig),null==a||a(n),n.exec()}))})(e,t,r,l,a,o)};const{useState:R,useRef:x,useEffect:S,forwardRef:I}=e.React,C=e.css`
    width: 100%;
    height: 100%;
    position: absolute;
    left: 0;
    bottom: 0;
    top: 0;
    right: 0;
    background: transparent;
    z-index: -1;
    > .drop-area {
      width: 100%;
      height: 100%;
    }
    > .overlay {
      position: absolute;
      left: 0;
      bottom: 0;
      top: 0;
      right: 0;
      background: transparent;
      z-index: -1;
      &.hide {
        display: none;
      }
    }
  `,j=I(((o,l)=>{const{widgetId:a,layout:i,layouts:n,vertical:s,childClass:c,placeholder:d,className:g}=o,v=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(r=Object.getOwnPropertySymbols(e);l<r.length;l++)t.indexOf(r[l])<0&&Object.prototype.propertyIsEnumerable.call(e,r[l])&&(o[r[l]]=e[r[l]])}return o}(o,["widgetId","layout","layouts","vertical","childClass","placeholder","className"]),{color:h,size:[f,m]}=d,y=x(null),b=x(null),I=x(null),j=x(null),O=x(null),[A,k]=R(!1),L=t.hooks.useForkRef(y,l);S((()=>{b.current=new p.CanvasPane(O.current)}),[]);const N=w(a,r);return(0,e.jsx)("div",Object.assign({className:(0,e.classNames)("drop-zone",g),ref:L},v,{css:C}),(0,e.jsx)(p.DropArea,{style:C,className:"drop-area",layouts:n,highlightDragover:!0,onDragOver:(t,o,r,l)=>{let a=l;const i=j.current,n=y.current.offsetHeight,c=y.current.offsetWidth;if(i&&i.length)if(s){const{insertY:e,refId:t}=((e,t,o)=>{const r=t.top+t.height/2;let l,a,i=!1;if(o.some(((e,t)=>{if(e.top+e.height/2>r){if(0===t)l=e.top/2;else{const r=o[t-1];l=(e.top+r.top+r.height)/2}i=!0,a=e.id}return i})),!i){const t=o[o.length-1];l=(t.top+t.height+e.height)/2}return{insertY:l,refId:a}})(r,a,i);I.current=t,a={top:e-f/2+y.current.scrollTop,width:f,left:(c-f)/2+y.current.scrollLeft,height:m}}else{const{insertX:e,refId:t}=((e,t,o)=>{const r=t.left+t.width/2;let l,a,i=!1;if(o.some(((e,t)=>{if(e.left+e.width/2>r){if(0===t)l=e.left/2;else{const r=o[t-1];l=(e.left+r.left+r.width)/2}i=!0,a=e.id}return i})),!i){const t=o[o.length-1];l=(t.left+t.width+e.width)/2}return{insertX:l,refId:a}})(r,a,i);I.current=t,a={left:e-m/2+y.current.scrollLeft,width:m,top:(n-f)/2+y.current.scrollTop,height:f}}else a=s?{top:r.height/2-m/2,width:f,left:m/2,height:m}:{left:r.width/2-m/2,width:m,top:(n-f)/2+y.current.scrollTop,height:f};b.current.clear(),b.current.setColor(e.polished.rgba(h,1)),b.current.drawRect(a)},onDrop:(e,t,o)=>{b.current.clear();let r=0;I.current?r=i.order&&i.order.indexOf(I.current)||0:i.order&&(r=i.order.length),N(i,e,t,o,r),I.current=null,j.current=[]},onToggleDragoverEffect:e=>{e&&(I.current=null,(()=>{j.current=[];const e=y.current.getBoundingClientRect(),t=y.current.parentNode.querySelectorAll(`.${c}`);t&&t.length&&t.forEach((t=>{const o=t.getAttribute("data-layoutitemid");if(i.order&&i.order.includes(o)){const r=u.utils.relativeClientRect(t.getBoundingClientRect(),e);r.id=o,j.current.push(r)}})),s?j.current.sort(((e,t)=>e.top-t.top)):j.current.sort(((e,t)=>e.left-t.left))})(),b.current.setSize(y.current.clientWidth,y.current.clientHeight)),k(e)}}),(0,e.jsx)("canvas",{className:(0,e.classNames)("overlay",{hide:!A}),ref:O}))}));var O=c(55339),A=c.n(O);const k=(0,p.withRnd)(!1)((o=>{var r,l;const{markerEnabled:a,onMarkerClick:i,widgetid:n,showLabel:c,showTooltip:d,labelGrowth:u,avatar:p,onClick:g,active:v,editDraggable:h,className:f}=o,m=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets)||void 0===t?void 0:t[n]}));return m?e.React.createElement(s,{"data-widgetid":n,className:`rw-controller__widget-avatar-card ${f}`,showLabel:c,showTooltip:d,labelGrowth:u,avatar:p,label:m.label,icon:m.icon,autoFlip:null===(l=null===(r=null==m?void 0:m.manifest)||void 0===r?void 0:r.properties)||void 0===l?void 0:l.flipIcon,marker:a?A():"",active:v,editDraggable:h,onMarkerClick:i,onClick:g}):e.React.createElement(t.Loading,null)})),L=t=>{const{className:o,draggable:r,layoutId:l,layoutItem:a,onClick:i,label:n,showLabel:s,showTooltip:c,labelGrowth:d,markerEnabled:u,avatar:p,active:g,removeWidget:v}=t;return e.React.createElement(k,{className:(0,e.classNames)(o,"brw-controller__layout-item"),layoutId:l,layoutItem:a,widgetid:a.widgetId,layoutItemId:a.id,label:n,markerEnabled:u,showLabel:s,showTooltip:c,labelGrowth:d,avatar:p,active:g,editDraggable:r,useDragHandler:!0,onClick:i,onMarkerClick:()=>v(a.widgetId)})};var N=c(77756),E=c(34796),T=c(34750),P=c.n(T);const{useState:z,useRef:W}=e.React,M=e.css`
  width: 300px;
  height: 300px;
  overflow-y: auto;
`,B=o=>{const{layout:r,item:l,insertSyncWidgetToLayout:a}=o,i=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(r=Object.getOwnPropertySymbols(e);l<r.length;l++)t.indexOf(r[l])<0&&Object.prototype.propertyIsEnumerable.call(e,r[l])&&(o[r[l]]=e[r[l]])}return o}(o,["layout","item","insertSyncWidgetToLayout"]),[n,c]=z(!1),d=W(null),u=W((0,E.getBuilderThemeVariables)()),p=t.hooks.useTranslate();return(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s,Object.assign({},l,i,{title:p("addWidget"),icon:t.utils.toIconResult(P(),"add"),ref:d,onClick:e=>{e.stopPropagation(),c((e=>!e))}})),n&&(0,e.jsx)(N.WidgetListPopper,{css:M,builderTheme:u.current,referenceElement:d.current,isItemAccepted:y,onItemSelect:e=>{var t,o;const l=null!==(o=null===(t=r.order)||void 0===t?void 0:t.length)&&void 0!==o?o:0;a(r,e,{},{},l)},onClose:()=>{var e;c(!1),null===(e=d.current)||void 0===e||e.focus()}}))};const{useMemo:D,forwardRef:$}=e.React,H=$(((t,l)=>{const{widgetId:a,draggable:n,itemStyle:s,vertical:c,className:d,space:p,dropZoneRef:m,onItemClick:R,onClick:x,scrollListRef:S}=t,I=function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(r=Object.getOwnPropertySymbols(e);l<r.length;l++)t.indexOf(r[l])<0&&Object.prototype.propertyIsEnumerable.call(e,r[l])&&(o[r[l]]=e[r[l]])}return o}(t,["widgetId","draggable","itemStyle","vertical","className","space","dropZoneRef","onItemClick","onClick","scrollListRef"]),C=e.ReactRedux.useSelector((e=>{var t,o,r;return null===(r=null===(o=null===(t=e.appConfig.widgets)||void 0===t?void 0:t[a])||void 0===o?void 0:o.layouts)||void 0===r?void 0:r.controller})),O=h(a,r),A=f(O),k=(0,E.getBuilderThemeVariables)(),N=v(a,r),T=Object.keys(N).filter((t=>N[t].state===e.WidgetState.Opened)),P=((e,t)=>{const o=null==e?void 0:e.showLabel,r=null==e?void 0:e.labelGrowth,l=null==e?void 0:e.avatar.size,a=null==e?void 0:e.avatar.shape;return i(l,o,a)+t+r})(s,p),z={color:null==k?void 0:k.colors.palette.primary[700],size:[P,5]},W=(M=a,r,e=>{const t=(0,g.getAppConfigAction)();t.removeWidget(e),b(t,M,"controller"),t.exec()});var M;const $=w(a,r),H=((t,o,r,l)=>D((()=>{var a,n;const s=Object.assign(Object.assign({},o),{showLabel:!r&&(null==o?void 0:o.showLabel),avatar:null==o?void 0:o.avatar});return{position:"end",length:i(null===(a=null==o?void 0:o.avatar)||void 0===a?void 0:a.size,null==o?void 0:o.showLabel,null===(n=null==o?void 0:o.avatar)||void 0===n?void 0:n.shape),node:e.React.createElement(B,{className:"scroll-list-item",insertSyncWidgetToLayout:l,layout:t,item:s})}}),[o,t,r,l]))(O,s,0===A.length,$);return e.React.createElement(u.LayoutContext.Provider,{value:{isItemAccepted:y}},e.React.createElement("div",{ref:l,className:"layout controller-layout w-100 h-100","data-layoutid":O.id,onClick:x},e.React.createElement(j,{widgetId:a,vertical:c,layout:O,childClass:`layout-${O.id}-item`,placeholder:z,layouts:C}),e.React.createElement(o,Object.assign({},I,{scrollRef:S,className:(0,e.classNames)(d,"layout-item-list"),vertical:c,placeholder:H,itemLength:P,space:p,autoHideArrow:!0,lists:A,autoScrollEnd:!0,createItem:(t,o)=>{const r=O.content[t],l=r&&r.widgetId||"",a=T.includes(l);return e.React.createElement(L,Object.assign({},s,{key:t,className:(0,e.classNames)(`layout-${null==O?void 0:O.id}-item layout-item`,o),widgetid:l,layoutId:O.id,layoutItemId:t,draggable:n,markerEnabled:!0,layoutItem:r,active:a,removeWidget:W,onClick:R}))}}))))})),{useEffect:_,useState:G}=e.React,V=e.css`
  max-width: 100vw !important; 
  /* hide rnd-resize bar for the outermost layout item */
  .controller-configuration-container > * > * > .builder-layout-item > .select-wrapper > .action-area {
      > .rnd-resize-top,
      > .rnd-resize-right,
      > .rnd-resize-bottom,
      > .rnd-resize-left {
        display: none;
      }
    }

    .controller-configuration-container .builder-layout-item > .select-wrapper > .lock-layout-tip {
      display: none;
    }

  .selectable {
    > div {
      cursor: default;
    }
  }

  .widget-container {
    height: 100%;
    overflow: auto;
  }
`,F={width:150,height:150},U={width:300,height:300},q=()=>!1,X=o=>{var r,l;const{reference:a,placement:i,widgetId:n,controllerId:s,onClose:c,onSizeChange:d,size:v,version:f}=o,m=e.ReactRedux.useSelector((e=>{var t,o,r;return null===(r=null===(o=null===(t=e.appConfig.widgets)||void 0===t?void 0:t[s])||void 0===o?void 0:o.layouts)||void 0===r?void 0:r._openwidget})),y=h(s,"_openwidget"),b=(t=>e.ReactRedux.useSelector((o=>{const r=o.appRuntimeInfo.selection,l=o.appConfig;let a=!1;if(r&&l.layouts[r.layoutId]){const o=l.layouts[r.layoutId].content[r.layoutItemId],i=o&&o.widgetId;let n=[];i&&(n=u.searchUtils.getChildrenContents(l,i,e.LayoutItemType.Widget,!1));let s=[i,t];n&&(s=s.concat(n)),a=s.includes(i)}return a})))(s),w=null===(l=null===(r=(0,e.getAppStore)().getState().appConfig.widgets)||void 0===r?void 0:r[n])||void 0===l?void 0:l.label,[R,x]=G(!!n);t.hooks.useUpdateEffect((()=>{x(!1),setTimeout((()=>{x(!!n)}),100)}),[n]),_((()=>{b||null==c||c()}),[b,c]);const S=t.hooks.useRefValue(y);return _((()=>{n&&((t,o)=>{if(o){let r=(0,g.getAppConfigAction)().appConfig;const l=(e=>({type:"WIDGET",widgetId:e,bbox:{left:0,top:0,bottom:0,right:0},id:"0"}))(t);r=r.setIn(["layouts",o.id,"content",l.id],l).setIn(["layouts",o.id,"order"],[l.id]),(0,g.getAppConfigAction)(r).exec(),(0,e.getAppStore)().dispatch(e.appActions.selectionChanged((0,e.Immutable)({layoutId:o.id,layoutItemId:"0"})))}})(n,S.current)}),[n,S]),(0,e.jsx)(e.React.Fragment,null,R&&(0,e.jsx)(t.Popper,{floating:!0,open:!0,headerTitle:w,onHeaderClose:c,minSize:F,onResize:e=>{d(n,e)},dragBounds:"body",defaultSize:v||U,css:V,version:f,className:"flex-grow-1",reference:a,toggle:e=>{if("Escape"===(null==e?void 0:e.key)){null==c||c();const e=null==a?void 0:a.querySelector("button");null==e||e.focus()}},placement:i},(0,e.jsx)("div",{className:"widget-container controller-configuration-container d-flex p-1"},(0,e.jsx)(p.LayoutBuilder,{isItemAccepted:q,layouts:m,itemDraggable:!1,itemResizable:!0,showDefaultTools:!1}))))},{useSelector:Y}=e.ReactRedux,{useEffect:Z,useRef:J,useState:K}=e.React,Q={Builder:t=>{var o,l,a,i;const{id:n,config:s,version:c}=t,d=null===(o=null==s?void 0:s.behavior)||void 0===o?void 0:o.vertical,u=null===(l=s.behavior)||void 0===l?void 0:l.size,p=d?"right-start":"bottom",h=Y((e=>e.widgetsState[n])),f=null==h?void 0:h.version,m=J({hideArrow:!0,disablePrevious:!0,disableNext:!1,scroll:()=>{}}),{hideArrow:y,disablePrevious:b,disableNext:w,scroll:R}=m.current,[x,S]=K(null),I=v(n,r),C=Object.keys(I).filter((t=>I[t].state===e.WidgetState.Opened)),j=null==C?void 0:C[0],O=null==u?void 0:u[j];return Z((()=>{(0,e.getAppStore)().dispatch(e.appActions.closeWidgets(C))}),[c]),Z((()=>{(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(n,"hideArrow",y)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(n,"disablePrevious",b)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(n,"disableNext",w)),(0,e.getAppStore)().dispatch(e.appActions.widgetStatePropChange(n,"onArrowClick",R))}),[y,b,w,R,f,n]),e.React.createElement(e.React.Fragment,null,j&&e.React.createElement(X,{reference:x,version:c,widgetId:j,controllerId:n,size:O,onClose:()=>(0,e.getAppStore)().dispatch(e.appActions.closeWidgets(C)),onSizeChange:(t,o)=>{if(!t)return;let r=(null==s?void 0:s.behavior.size)||(0,e.Immutable)({});r=r.set(t,o),(e=>{(0,g.getAppConfigAction)().editWidgetConfig(n,e).exec()})(s.setIn(["behavior","size"],r))},placement:p}),e.React.createElement(H,{scrollListRef:m,vertical:null===(a=null==s?void 0:s.behavior)||void 0===a?void 0:a.vertical,widgetId:n,onItemClick:t=>{var o;const r=t.currentTarget,l=null===(o=r.dataset)||void 0===o?void 0:o.widgetid;S(r),(0,e.getAppStore)().dispatch(e.appActions.closeWidgets(C)),(0,e.getAppStore)().dispatch(e.appActions.openWidget(l))},itemStyle:s.appearance.card,draggable:!0,space:null===(i=null==s?void 0:s.appearance)||void 0===i?void 0:i.space}))}}})(),d})())}}}));